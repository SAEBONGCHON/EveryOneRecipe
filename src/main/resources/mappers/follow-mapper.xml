<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="followMapper">

	<select id="isFollowed" parameterType="map" resultType="_int">
		select count(*) from FOLLOWMAPPING where FWID=#{fwId} and USERID=#{userId} and ISDELETED='N'
	</select>

	<select id="getFollowInfo" parameterType="map" resultType="com.kh.everyrecipe.followMapping.vo.FollowMappingVo">
		select * from FOLLOWMAPPING where FWID=#{fwId} and USERID=#{userId}
	</select>
	
	<insert id="addFollower">
		insert into FOLLOWMAPPING values(#{fwId}, #{userId}, default) 
	</insert>
	
	<update id="reAddFollower">
		update FOLLOWMAPPING set ISDELETED='N' where FWID=#{fwId} and USERID=#{userId}
	</update>
	
	<update id="removeFollower">
		update FOLLOWMAPPING set ISDELETED='Y' where FWID=#{fwId} and USERID=#{userId}
	</update>
	

	<select id="getFollowerCount" parameterType="string" resultType="_int">
		select count(*) from FOLLOWMAPPING where userid=#{userId} and ISDELETED ='N'
	</select>
	<select id="getFollowingCount" parameterType="string" resultType="_int">
		select count(*) from FOLLOWMAPPING where fwid=#{userId} and ISDELETED ='N'
	</select>
	<select id="getFollower" parameterType="string" resultType="string">
		select fwid from FOLLOWMAPPING where USERID=#{userId} and ISDELETED ='N'
	</select>
	<select id="getFollowing" parameterType="string" resultType="string">
		select userId from FOLLOWMAPPING where FWID=#{fwId} and ISDELETED ='N'
	</select>
	
	<!-- 추천 게시물(좋아요 많은 순서) 피드 -->
	<select id="getRecommendPost" resultType="bvo">
		SELECT P.*
		FROM (
   			SELECT post.postid, nickname, content, FOODNAME, count(post.postid)
			FROM POST
			inner join POSTLIKE
			on POST.postid = POSTLIKE.POSTID
			where POSTLIKE.ISDELETED='N'
			group by post.postid, nickname, content, FOODNAME
			ORDER BY count(post.postid) DESC
   			) P
		WHERE ROWNUM<![CDATA[<=]]>11	
	</select>
	
	<!-- 게시물 피드(팔로잉 중인 유저의 게시물만) -->
	<select id="getFollowingPost" resultType="bvo">
		SELECT *
		from POST
		WHERE POST.userId
		IN (select userId from FOLLOWMAPPING where FWID=#{fwId} and ISDELETED ='N')
		order by createat desc	
	</select>	
</mapper>
